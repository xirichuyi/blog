import{u as R,a as U,r as n,j as e,b as B}from"./index-Cfx8vNNh.js";import{A as F}from"./ArticleCard-8oAlXAIq.js";import{M as I}from"./MarkdownRenderer-EnzfZmAz.js";const O=({articleId:d})=>{const m=R(),{fetchArticleById:p,articles:j}=U(),[a,T]=n.useState(null),[h,y]=n.useState(!0),[N,u]=n.useState(null),[v,C]=n.useState([]),[g,b]=n.useState(""),[w,A]=n.useState(!1);n.useEffect(()=>{(async()=>{y(!0),u(null);try{const s=await p(d);if(s){T(s);const l=j.filter(c=>c.id!==d&&c.category===s.category).slice(0,3);C(l)}else u("Article not found")}catch(s){u("Failed to load article"),console.error("Error loading article:",s)}finally{y(!1)}})()},[d,p,j]);const f=n.useCallback(()=>{if(w)return;const t=Array.from(document.querySelectorAll("h2[id], h3[id]"));if(t.length===0)return;const s=window.scrollY,l=window.innerHeight,c=s+l*.2;let i="";for(let r=t.length-1;r>=0;r--){const o=t[r];if(o.offsetTop<=c){i=o.id;break}}!i&&t.length>0&&s<200&&(i=t[0].id),i&&i!==g&&b(i)},[g,w]);n.useEffect(()=>{if(a&&!h){const t=setTimeout(()=>{f()},500);let s=!1;const l=()=>{s||(requestAnimationFrame(()=>{f(),s=!1}),s=!0)};return window.addEventListener("scroll",l,{passive:!0}),()=>{clearTimeout(t),window.removeEventListener("scroll",l)}}},[a,h,f]);const E=t=>{m(`/article/${t}`)},D=(t,s)=>{t.preventDefault();const l=document.getElementById(s);if(l){A(!0),b(s);const c=l.offsetTop-100,i=c;window.scrollTo({top:c,behavior:"smooth"});let r=0;const o=40,x=()=>{const S=window.scrollY,$=Math.abs(S-i)<10,M=r>10&&Math.abs(S-i)<50;r++,$||M||r>=o?A(!1):setTimeout(x,50)};setTimeout(x,200)}},H=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),L=t=>{const s=/^(#{1,3})\s+(.+)$/gm,l=[];let c;for(;(c=s.exec(t))!==null;){const i=c[1].length,r=c[2].trim(),o=r.toLowerCase().replace(/\s+/g,"-").replace(/[^\u4e00-\u9fff\w-]/g,"").replace(/^-+|-+$/g,"");i>=2&&i<=3&&l.push({level:i,text:r,id:o})}return l};if(h)return e.jsxs("div",{className:"article-detail-loading",children:[e.jsx("md-circular-progress",{indeterminate:!0}),e.jsx("span",{className:"md-typescale-body-large",children:"Loading article..."})]});if(N||!a)return e.jsxs("div",{className:"article-detail-error",children:[e.jsx("md-icon",{className:"error-icon",children:"error_outline"}),e.jsx("h2",{className:"md-typescale-headline-medium",children:"Article Not Found"}),e.jsx("p",{className:"md-typescale-body-large",children:N||"The article you're looking for doesn't exist."}),e.jsxs("md-filled-button",{onClick:()=>m("/articles"),children:[e.jsx("md-icon",{slot:"icon",children:"arrow_back"}),"Back to Articles"]})]});const k=L(a.content||"");return e.jsxs("div",{className:"article-detail",children:[e.jsxs("main",{className:"article-main",children:[e.jsxs("article",{className:"article-header",children:[a.imageUrl&&e.jsx("div",{className:"article-hero-image",children:e.jsx("img",{src:B.getImageUrl(a.imageUrl),alt:a.title,loading:"eager"})}),e.jsxs("div",{className:"article-header-content",children:[e.jsxs("div",{className:"article-meta",children:[e.jsxs("md-assist-chip",{className:"article-category",children:[e.jsx("md-icon",{slot:"icon",children:"category"}),a.category]}),e.jsx("span",{className:"article-date md-typescale-body-medium",children:H(a.publishDate)}),e.jsxs("span",{className:"article-read-time md-typescale-body-medium",children:[a.readTime," min read"]})]}),e.jsx("h1",{className:"article-title md-typescale-display-small",children:a.title}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"article-tags",children:a.tags.map((t,s)=>e.jsx("md-filter-chip",{className:"article-tag",disabled:!0,children:t},s))})]})]}),e.jsx("div",{className:"article-content",children:e.jsx(I,{content:a.content||"",className:"article-body md-typescale-body-large"})}),v.length>0&&e.jsxs("section",{className:"related-articles",children:[e.jsx("h2",{className:"related-articles-title md-typescale-headline-medium",children:"Related Articles"}),e.jsx("div",{className:"related-articles-grid",children:v.map(t=>e.jsx(F,{...t,onClick:E,className:"related-article-card",simplified:!0},t.id))})]}),e.jsx("div",{className:"see-more-section",children:e.jsxs("md-filled-button",{className:"see-more-button",onClick:()=>m("/articles"),children:[e.jsx("md-icon",{slot:"icon",children:"library_books"}),"See More Articles"]})})]}),k.length>0&&e.jsx("aside",{className:"article-sidebar",children:e.jsxs("div",{className:"article-outline",children:[e.jsx("h3",{className:"outline-title md-typescale-title-medium",children:"Table of Contents"}),e.jsx("nav",{className:"outline-nav",children:k.map((t,s)=>e.jsx("div",{className:`outline-item outline-level-${t.level} md-typescale-body-medium ${g===t.id?"active":""}`,children:e.jsx("a",{href:`#${t.id}`,onClick:l=>D(l,t.id),children:t.text})},s))})]})})]})};export{O as default};
