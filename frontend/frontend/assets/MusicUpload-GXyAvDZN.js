import{r,u as U,h as k,j as e,b as E}from"./index-Cfx8vNNh.js";import{a as B}from"./musicMetadata-xW89Yeq0.js";import{A as G}from"./AdminLayout-DBr5zY72.js";const R=()=>{const[i,f]=r.useState({title:"",artist:"",album:"",genre:""}),[o,c]=r.useState(null),[d,m]=r.useState(null),[h,j]=r.useState(!1),[g,u]=r.useState(0),[v,t]=r.useState(null),[A,x]=r.useState(!1),y=U(),{showNotification:D}=k(),N=r.useRef(null),P=()=>o&&i.title.trim()&&i.artist.trim()&&!h,p=(s,l)=>{f(a=>({...a,[s]:l}))},b=async s=>{if(s)try{const l=await B(s);if(!l.isValid){t("Please select a valid audio file (MP3, WAV, OGG, MP4, AAC, FLAC)"),c(null);return}const a=50*1024*1024;if(s.size>a){t("File size must be less than 50MB"),c(null);return}c(s),t(null),f(n=>({...n,title:n.title||l.metadata.title||s.name.replace(/\.[^/.]+$/,""),artist:n.artist||l.metadata.artist||"",album:n.album||l.metadata.album||"",genre:n.genre||l.metadata.genre||""})),console.log("Audio file analysis:",l)}catch(l){console.error("Failed to analyze audio file:",l),t("Failed to analyze audio file. Please try again."),c(null)}else c(null),t(null)},F=s=>{if(s){if(!["image/jpeg","image/png","image/webp"].includes(s.type)){t("Please select a valid image file (JPEG, PNG, WebP)"),m(null);return}const a=5*1024*1024;if(s.size>a){t("Cover image size must be less than 5MB"),m(null);return}m(s),t(null)}else m(null),t(null)},z=s=>{s.preventDefault(),x(!0)},w=s=>{s.preventDefault(),x(!1)},M=(s,l)=>{s.preventDefault(),x(!1);const a=Array.from(s.dataTransfer.files);a.length>0&&(l==="music"?b(a[0]):F(a[0]))},I=async()=>{try{if(j(!0),t(null),u(0),!i.title.trim())throw new Error("Title is required");if(!i.artist.trim())throw new Error("Artist is required");if(!o)throw new Error("Please select a music file");const s=new FormData;s.append("title",i.title.trim()),s.append("artist",i.artist.trim()),s.append("album",i.album.trim()),s.append("genre",i.genre),s.append("music",o),d&&s.append("cover",d);const l=setInterval(()=>{u(n=>n>=90?(clearInterval(l),90):n+10)},200),a=await E.uploadMusic(s);if(clearInterval(l),u(100),a.success)D({type:"success",title:"Music Uploaded!",message:`"${i.title}" has been uploaded successfully.`}),setTimeout(()=>{y("/admin/music")},1e3);else throw new Error(a.error||"Upload failed")}catch(s){t(s instanceof Error?s.message:"Upload failed"),u(0)}finally{j(!1)}},S=()=>{confirm("Are you sure you want to cancel? All changes will be lost.")&&y("/admin/music")},C=s=>{if(s===0)return"0 Bytes";const l=1024,a=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(l));return parseFloat((s/Math.pow(l,n)).toFixed(2))+" "+a[n]};return e.jsx(G,{title:"Upload Music",children:e.jsxs("div",{className:"music-upload",children:[v&&e.jsxs("div",{className:"upload-error",children:[e.jsx("md-icon",{children:"error"}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"upload-header",children:[e.jsxs("div",{className:"upload-title",children:[e.jsx("h1",{className:"md-typescale-display-small",children:"Upload Music"}),e.jsx("p",{className:"md-typescale-body-large",children:"Add new music tracks to your collection"})]}),e.jsxs("div",{className:"upload-actions",children:[e.jsx("md-text-button",{onClick:S,children:"Cancel"}),e.jsx("md-filled-button",{onClick:I,disabled:!P(),children:h?e.jsxs(e.Fragment,{children:[e.jsx("md-circular-progress",{indeterminate:!0,slot:"icon",style:{width:"18px",height:"18px"}}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("md-icon",{slot:"icon",children:"upload"}),"Upload Music"]})})]})]}),h&&e.jsxs("div",{className:"upload-progress",children:[e.jsxs("div",{className:"progress-info",children:[e.jsx("span",{className:"md-typescale-body-medium",children:"Uploading..."}),e.jsxs("span",{className:"md-typescale-body-medium",children:[g,"%"]})]}),e.jsx("md-linear-progress",{value:g/100})]}),e.jsxs("div",{className:"upload-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"md-typescale-headline-small",children:"Files"}),e.jsxs("div",{className:"file-upload-section",children:[e.jsx("label",{className:"md-typescale-title-medium",children:"Music File *"}),e.jsxs("div",{className:`file-drop-zone ${A?"drag-over":""} ${o?"has-file":""}`,onDragOver:z,onDragLeave:w,onDrop:s=>M(s,"music"),children:[o?e.jsxs("div",{className:"file-info",children:[e.jsx("md-icon",{class:"file-icon",children:"audio_file"}),e.jsxs("div",{className:"file-details",children:[e.jsx("span",{className:"file-name md-typescale-body-large",children:o.name}),e.jsx("span",{className:"file-size md-typescale-body-medium",children:C(o.size)})]}),e.jsx("md-icon-button",{onClick:()=>c(null),children:e.jsx("md-icon",{children:"close"})})]}):e.jsxs("div",{className:"drop-zone-content",children:[e.jsx("md-icon",{class:"upload-icon",children:"cloud_upload"}),e.jsx("p",{className:"md-typescale-body-large",children:"Drag and drop your music file here"}),e.jsx("p",{className:"md-typescale-body-medium",children:"or"}),e.jsxs("md-outlined-button",{onClick:()=>N.current?.click(),children:[e.jsx("md-icon",{slot:"icon",children:"folder_open"}),"Browse Files"]}),e.jsx("p",{className:"md-typescale-body-small",children:"Supported formats: MP3, WAV, OGG, MP4 (Max 50MB)"})]}),e.jsx("input",{ref:N,type:"file",accept:"audio/*",onChange:s=>b(s.target.files?.[0]||null),style:{display:"none"}})]})]}),e.jsxs("div",{className:"file-upload-section",children:[e.jsx("label",{className:"md-typescale-title-medium",children:"Cover Image (Optional)"}),e.jsxs("div",{className:`file-drop-zone cover-zone ${d?"has-file":""}`,onDragOver:z,onDragLeave:w,onDrop:s=>M(s,"cover"),children:[d?e.jsxs("div",{className:"file-info",children:[e.jsx("md-icon",{class:"file-icon",children:"image"}),e.jsxs("div",{className:"file-details",children:[e.jsx("span",{className:"file-name md-typescale-body-large",children:d.name}),e.jsx("span",{className:"file-size md-typescale-body-medium",children:C(d.size)})]}),e.jsx("md-icon-button",{onClick:()=>m(null),children:e.jsx("md-icon",{children:"close"})})]}):e.jsxs("div",{className:"drop-zone-content",children:[e.jsx("md-icon",{class:"upload-icon",children:"image"}),e.jsx("p",{className:"md-typescale-body-medium",children:"Add cover image"}),e.jsxs("md-text-button",{children:[e.jsx("md-icon",{slot:"icon",children:"add_photo_alternate"}),"Browse Images"]})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>F(s.target.files?.[0]||null),style:{display:"none"}})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"md-typescale-headline-small",children:"Track Information"}),e.jsxs("div",{className:"metadata-grid",children:[e.jsx("md-outlined-text-field",{label:"Title *",value:i.title,onInput:s=>p("title",s.target.value),required:!0,class:"metadata-field"}),e.jsx("md-outlined-text-field",{label:"Artist *",value:i.artist,onInput:s=>p("artist",s.target.value),required:!0,class:"metadata-field"}),e.jsx("md-outlined-text-field",{label:"Album",value:i.album,onInput:s=>p("album",s.target.value),class:"metadata-field"}),e.jsxs("md-outlined-select",{label:"Genre",value:i.genre,onInput:s=>p("genre",s.target.value),class:"metadata-field",children:[e.jsx("md-select-option",{value:"",children:"Select Genre"}),e.jsx("md-select-option",{value:"Ambient",children:"Ambient"}),e.jsx("md-select-option",{value:"Electronic",children:"Electronic"}),e.jsx("md-select-option",{value:"Lo-Fi",children:"Lo-Fi"}),e.jsx("md-select-option",{value:"Classical",children:"Classical"}),e.jsx("md-select-option",{value:"Jazz",children:"Jazz"}),e.jsx("md-select-option",{value:"Rock",children:"Rock"}),e.jsx("md-select-option",{value:"Pop",children:"Pop"}),e.jsx("md-select-option",{value:"Hip-Hop",children:"Hip-Hop"})]})]})]})]})]})})};export{R as default};
