import{r as n,j as e,u as B,h as G,b as E}from"./index-Cfx8vNNh.js";import{f as F}from"./musicMetadata-xW89Yeq0.js";import{A as L}from"./AdminLayout-DBr5zY72.js";const q=({track:i,isPlaying:p,onPlayPause:d,onNext:y,onPrevious:w,className:v=""})=>{const c=n.useRef(null),[j,a]=n.useState(0),[g,r]=n.useState(0),[m,N]=n.useState(1),[f,o]=n.useState(!1);n.useEffect(()=>{c.current&&i&&(c.current.src=i.file_url,c.current.load())},[i]),n.useEffect(()=>{c.current&&(p?c.current.play().catch(console.error):c.current.pause())},[p]);const h=()=>{c.current&&a(c.current.currentTime)},x=()=>{c.current&&r(c.current.duration)},b=S=>{const u=parseFloat(S.target.value);a(u),c.current&&(c.current.currentTime=u)},C=S=>{const u=parseFloat(S.target.value);N(u),c.current&&(c.current.volume=u),o(u===0)},T=()=>{c.current&&(f?(c.current.volume=m,o(!1)):(c.current.volume=0,o(!0)))},M=()=>{y&&y()};return i?e.jsxs("div",{className:`music-player ${v}`,children:[e.jsx("audio",{ref:c,onTimeUpdate:h,onLoadedMetadata:x,onEnded:M,preload:"metadata"}),e.jsxs("div",{className:"player-content",children:[e.jsxs("div",{className:"track-info",children:[i.cover_url?e.jsx("img",{src:i.cover_url,alt:i.title,className:"track-cover"}):e.jsx("div",{className:"track-cover default",children:e.jsx("md-icon",{children:"music_note"})}),e.jsxs("div",{className:"track-details",children:[e.jsx("h4",{className:"track-title md-typescale-title-medium",children:i.title}),e.jsx("p",{className:"track-artist md-typescale-body-medium",children:i.artist})]})]}),e.jsxs("div",{className:"player-controls",children:[w&&e.jsx("md-icon-button",{onClick:w,children:e.jsx("md-icon",{children:"skip_previous"})}),e.jsx("md-icon-button",{onClick:d,class:"play-button",children:e.jsx("md-icon",{children:p?"pause":"play_arrow"})}),y&&e.jsx("md-icon-button",{onClick:y,children:e.jsx("md-icon",{children:"skip_next"})})]}),e.jsxs("div",{className:"player-progress",children:[e.jsx("span",{className:"time-current md-typescale-body-small",children:F(j)}),e.jsx("input",{type:"range",min:"0",max:g||0,value:j,onChange:b,className:"progress-slider"}),e.jsx("span",{className:"time-total md-typescale-body-small",children:F(g)})]}),e.jsxs("div",{className:"player-volume",children:[e.jsx("md-icon-button",{onClick:T,children:e.jsx("md-icon",{children:f||m===0?"volume_off":m<.5?"volume_down":"volume_up"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:f?0:m,onChange:C,className:"volume-slider"})]})]})]}):e.jsx("div",{className:`music-player empty ${v}`,children:e.jsxs("div",{className:"player-content",children:[e.jsx("md-icon",{class:"music-icon",children:"music_note"}),e.jsx("span",{className:"md-typescale-body-medium",children:"No track selected"})]})})},O=()=>{const[i,p]=n.useState([]),[d,y]=n.useState([]),[w,v]=n.useState(!0),[c,j]=n.useState(null),[a,g]=n.useState({search:"",genre:""}),[r,m]=n.useState(new Set),[N,f]=n.useState(null),[o,h]=n.useState(!1),[x,b]=n.useState(null),C=B(),{showNotification:T}=G();n.useEffect(()=>{M()},[]),n.useEffect(()=>{S()},[i,a]);const M=async()=>{try{v(!0),j(null);const s=await E.getMusicTracks({search:a.search,genre:a.genre});if(s.success&&s.data)p(s.data);else throw new Error(s.error||"Failed to load music tracks")}catch(s){j(s instanceof Error?s.message:"Failed to load music tracks")}finally{v(!1)}},S=()=>{let s=[...i];if(a.search){const t=a.search.toLowerCase();s=s.filter(l=>l.title.toLowerCase().includes(t)||l.artist.toLowerCase().includes(t)||l.album?.toLowerCase().includes(t))}a.genre&&(s=s.filter(t=>t.genre===a.genre)),y(s)},u=()=>{C("/admin/music/upload")},_=s=>{const t=d.find(l=>l.id===s);t&&(N===s&&o?h(!1):(N===s&&!o||(f(s),b(t)),h(!0)))},D=()=>{h(!o)},z=()=>{if(!x)return;const t=(d.findIndex(k=>k.id===x.id)+1)%d.length,l=d[t];f(l.id),b(l),h(!0)},P=()=>{if(!x)return;const s=d.findIndex(k=>k.id===x.id),t=s===0?d.length-1:s-1,l=d[t];f(l.id),b(l),h(!0)},U=async s=>{if(confirm("Are you sure you want to delete this track?"))try{const t=await E.deleteMusic(s);if(t.success){p(i.filter(k=>k.id!==s));const l=new Set(r);l.delete(s),m(l),T({type:"success",title:"Track Deleted",message:"The music track has been deleted successfully."})}else throw new Error(t.error||"Failed to delete track")}catch(t){j(t instanceof Error?t.message:"Failed to delete track")}},$=s=>{const t=new Set(r);t.has(s)?t.delete(s):t.add(s),m(t)},A=async()=>{if(r.size!==0&&confirm(`Are you sure you want to delete ${r.size} tracks?`))try{const s=await E.bulkDeleteMusic(Array.from(r));if(s.success){const t=r.size;p(i.filter(l=>!r.has(l.id))),m(new Set),T({type:"success",title:"Tracks Deleted",message:`${t} track${t>1?"s":""} deleted successfully.`})}else throw new Error(s.error||"Failed to delete tracks")}catch(s){j(s instanceof Error?s.message:"Failed to delete tracks")}},I=s=>{const t=Math.floor(s/60),l=s%60;return`${t}:${l.toString().padStart(2,"0")}`},R=s=>`${s.toFixed(1)} MB`,V=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return w?e.jsx(L,{title:"Music Management",children:e.jsxs("div",{className:"music-management-loading",children:[e.jsx("md-circular-progress",{indeterminate:!0}),e.jsx("p",{className:"md-typescale-body-medium",children:"Loading music tracks..."})]})}):c?e.jsx(L,{title:"Music Management",children:e.jsxs("div",{className:"music-management-error",children:[e.jsx("md-icon",{class:"error-icon",children:"error"}),e.jsx("h2",{className:"md-typescale-headline-small",children:"Error Loading Music"}),e.jsx("p",{className:"md-typescale-body-medium",children:c}),e.jsxs("md-filled-button",{onClick:M,children:[e.jsx("md-icon",{slot:"icon",children:"refresh"}),"Retry"]})]})}):e.jsx(L,{title:"Music Management",children:e.jsxs("div",{className:"music-management",children:[e.jsxs("div",{className:"music-header",children:[e.jsxs("div",{className:"music-header-title",children:[e.jsx("h1",{className:"md-typescale-display-small",children:"Music Library"}),e.jsx("p",{className:"md-typescale-body-large",children:"Manage your music collection and uploads"})]}),e.jsx("div",{className:"music-header-actions",children:e.jsxs("md-filled-button",{onClick:u,children:[e.jsx("md-icon",{slot:"icon",children:"upload"}),"Upload Music"]})})]}),x&&e.jsx("div",{className:"music-player-section",children:e.jsx(q,{track:x,isPlaying:o,onPlayPause:D,onNext:z,onPrevious:P})}),e.jsxs("div",{className:"music-filters",children:[e.jsx("md-outlined-text-field",{label:"Search music...",value:a.search,onInput:s=>g({...a,search:s.target.value}),class:"search-field",children:e.jsx("md-icon",{slot:"leading-icon",children:"search"})}),e.jsxs("md-outlined-select",{label:"Genre",value:a.genre,onInput:s=>g({...a,genre:s.target.value}),children:[e.jsx("md-select-option",{value:"",children:"All Genres"}),e.jsx("md-select-option",{value:"Ambient",children:"Ambient"}),e.jsx("md-select-option",{value:"Electronic",children:"Electronic"}),e.jsx("md-select-option",{value:"Lo-Fi",children:"Lo-Fi"}),e.jsx("md-select-option",{value:"Classical",children:"Classical"})]})]}),r.size>0&&e.jsxs("div",{className:"bulk-actions",children:[e.jsxs("span",{className:"md-typescale-body-medium",children:[r.size," track",r.size>1?"s":""," selected"]}),e.jsxs("md-text-button",{onClick:A,children:[e.jsx("md-icon",{slot:"icon",children:"delete"}),"Delete Selected"]})]}),e.jsx("div",{className:"music-grid",children:d.map(s=>e.jsx("md-elevated-card",{class:`music-card ${r.has(s.id)?"selected":""}`,children:e.jsxs("div",{className:"music-card-content",children:[e.jsx("div",{className:"card-selection",children:e.jsx("md-checkbox",{checked:r.has(s.id),onChange:()=>$(s.id)})}),e.jsxs("div",{className:"music-cover",children:[s.coverUrl?e.jsx("img",{src:s.coverUrl,alt:s.title}):e.jsx("div",{className:"default-cover",children:e.jsx("md-icon",{children:"music_note"})}),e.jsx("div",{className:"play-overlay",children:e.jsx("md-icon-button",{class:"play-button",onClick:()=>_(s.id),children:e.jsx("md-icon",{children:N===s.id&&o?"pause":"play_arrow"})})})]}),e.jsxs("div",{className:"music-info",children:[e.jsx("h3",{className:"track-title md-typescale-title-medium",children:s.title}),e.jsx("p",{className:"track-artist md-typescale-body-medium",children:s.artist}),s.album&&e.jsx("p",{className:"track-album md-typescale-body-small",children:s.album}),e.jsxs("div",{className:"track-meta",children:[e.jsx("span",{className:"duration",children:I(s.duration)}),s.genre&&e.jsx("md-assist-chip",{class:"genre-chip",children:s.genre})]}),e.jsxs("div",{className:"track-details",children:[e.jsx("span",{className:"file-size md-typescale-body-small",children:R(s.fileSize)}),e.jsx("span",{className:"upload-date md-typescale-body-small",children:V(s.uploadDate)})]})]}),e.jsx("div",{className:"music-actions",children:e.jsx("md-icon-button",{onClick:()=>U(s.id),children:e.jsx("md-icon",{children:"delete"})})})]})},s.id))}),d.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("md-icon",{class:"empty-icon",children:"library_music"}),e.jsx("h3",{className:"md-typescale-headline-small",children:"No music found"}),e.jsx("p",{className:"md-typescale-body-medium",children:a.search||a.genre?"Try adjusting your filters":"Upload your first music track to get started"}),!a.search&&!a.genre&&e.jsxs("md-filled-button",{onClick:u,children:[e.jsx("md-icon",{slot:"icon",children:"upload"}),"Upload Music"]})]})]})})};export{O as default};
